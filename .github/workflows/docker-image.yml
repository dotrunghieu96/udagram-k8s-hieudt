name: Docker Image CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run:
        docker-compose -f docker-compose-build.yaml build
        docker tag udagram-api-feed:latest dotrunghieu96/udagram-api-feed:$(date +%s)
        docker tag udagram-api-user:latest dotrunghieu96/udagram-api-user:$(date +%s)
        docker tag udagram-frontend:local dotrunghieu96/udagram-frontend:$(date +%s)
        docker tag reverseproxy:latest dotrunghieu96/reverseproxy:$(date +%s)
        
        echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        docker push dotrunghieu96/udagram-api-feed:$(date +%s)
        docker push dotrunghieu96/udagram-api-user:$(date +%s)
        docker push dotrunghieu96/udagram-frontend:$(date +%s)
        docker push dotrunghieu96/reverseproxy:$(date +%s)

